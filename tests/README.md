# æ¸¬è©¦èªªæ˜æ–‡ä»¶

æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„æ¸¬è©¦æ¶æ§‹ï¼Œæ¶µè“‹å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ï¼Œç¢ºä¿äº¤æ˜“ç³»çµ±çš„ç©©å®šæ€§å’Œå¯é æ€§ã€‚

## ğŸ“ æ¸¬è©¦ç›®éŒ„çµæ§‹

```
tests/
â”œâ”€â”€ README.md                          # æœ¬æ–‡ä»¶
â”œâ”€â”€ conftest.py                        # pytest å…¨åŸŸé…ç½®
â”œâ”€â”€ test_config.py                     # æ¸¬è©¦é…ç½®å’Œç’°å¢ƒè®Šæ•¸ç®¡ç†
â”œâ”€â”€ unit/                              # å–®å…ƒæ¸¬è©¦ï¼ˆå¿«é€Ÿï¼Œä½¿ç”¨ mockï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_fubon_account_unit.py     # å¯Œé‚¦å¸³æˆ¶å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ integration/                       # æ•´åˆæ¸¬è©¦ï¼ˆéœ€è¦çœŸå¯¦ API æ†‘è­‰ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_fubon_account_integration.py  # å¯Œé‚¦å¸³æˆ¶æ•´åˆæ¸¬è©¦
â”œâ”€â”€ fixtures/                          # æ¸¬è©¦æ•¸æ“šå’Œ mock ç‰©ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ fubon_sdk_responses.py         # å¯Œé‚¦ SDK æ¨™æº–å›æ‡‰æ ¼å¼
â”‚   â”œâ”€â”€ fubon_test_data.py             # å¯Œé‚¦æ¸¬è©¦æ•¸æ“š
â”‚   â””â”€â”€ fubon_mocks.py                 # å¯Œé‚¦ SDK mock ç‰©ä»¶
â””â”€â”€ utils/                             # æ¸¬è©¦å·¥å…·
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_base.py                   # æ¸¬è©¦åŸºç¤é¡
    â””â”€â”€ mock_helpers.py                # Mock è¼”åŠ©å‡½æ•¸
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒ
```bash
python run_tests.py --env-check
```

### 2. é‹è¡Œå–®å…ƒæ¸¬è©¦ï¼ˆæ¨è–¦é–‹å§‹ï¼‰
```bash
# é‹è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦
python run_tests.py --unit

# é‹è¡Œå¯Œé‚¦å¸³æˆ¶å–®å…ƒæ¸¬è©¦
python run_tests.py --fubon unit
```

### 3. é‹è¡Œæ•´åˆæ¸¬è©¦ï¼ˆéœ€è¦æ†‘è­‰ï¼‰
```bash
# é‹è¡Œå¯Œé‚¦å¸³æˆ¶æ•´åˆæ¸¬è©¦
python run_tests.py --fubon integration
```

## ğŸ§ª æ¸¬è©¦é¡å‹èªªæ˜

### å–®å…ƒæ¸¬è©¦ (Unit Tests)
- **ä½ç½®**: `tests/unit/`
- **ç‰¹é»**: å¿«é€ŸåŸ·è¡Œï¼ˆ< 1ç§’ï¼‰ï¼Œä½¿ç”¨ mockï¼Œç„¡å¤–éƒ¨ä¾è³´
- **ç›®çš„**: æ¸¬è©¦æ ¸å¿ƒé‚è¼¯å’Œæ•¸æ“šè™•ç†
- **é‹è¡Œ**: `python run_tests.py --unit`

**æ¸¬è©¦å…§å®¹**ï¼š
- æ•¸æ“šè§£æé‚è¼¯ï¼ˆæ™‚é–“ã€ç‹€æ…‹ã€æ•¸é‡è½‰æ›ï¼‰
- API å›æ‡‰æ˜ å°„ï¼ˆBSAction â†’ Actionï¼ŒOrderType â†’ OrderConditionï¼‰
- éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- é‚Šç·£æ¡ˆä¾‹è™•ç†

### æ•´åˆæ¸¬è©¦ (Integration Tests)
- **ä½ç½®**: `tests/integration/`
- **ç‰¹é»**: ä½¿ç”¨çœŸå¯¦ APIï¼Œéœ€è¦æœ‰æ•ˆæ†‘è­‰
- **ç›®çš„**: æ¸¬è©¦å®Œæ•´å·¥ä½œæµç¨‹å’Œ API æ•´åˆ
- **é‹è¡Œ**: `python run_tests.py --integration`

**æ¸¬è©¦å…§å®¹**ï¼š
- å¸³æˆ¶ç™»å…¥å’Œåˆå§‹åŒ–
- é¤˜é¡å’ŒæŒå€‰æŸ¥è©¢
- è‚¡ç¥¨å ±åƒ¹æŸ¥è©¢
- å§”è¨—å–®æ“ä½œï¼ˆå»ºç«‹ã€æ›´æ–°ã€å–æ¶ˆï¼‰
- OrderExecutor æ•´åˆåŠŸèƒ½

## ğŸ”‘ ç’°å¢ƒè¨­å®š

### å¯Œé‚¦è­‰åˆ¸æ¸¬è©¦æ†‘è­‰
```bash
export FUBON_NATIONAL_ID="ä½ çš„èº«åˆ†è­‰å­—è™Ÿ"
export FUBON_ACCOUNT_PASS="ä½ çš„ç™»å…¥å¯†ç¢¼"
export FUBON_CERT_PATH="/path/to/your/cert.pfx"

# å¯é¸è¨­å®š
export FUBON_CERT_PASS="æ†‘è­‰å¯†ç¢¼"
export FUBON_ACCOUNT="ç‰¹å®šå¸³è™Ÿ"
export FUBON_BASE_URL="APIåŸºåœ°å€"
```

### æª¢æŸ¥ç’°å¢ƒè¨­å®š
```bash
python run_tests.py --env-check
```
æœƒé¡¯ç¤ºï¼š
```
å¯Œé‚¦è­‰åˆ¸æ¸¬è©¦ç’°å¢ƒ: âœ… å·²é…ç½® / âŒ æœªé…ç½®
æ¸¬è©¦ç›®éŒ„: âœ… å­˜åœ¨
```

## ğŸ¯ å¸¸ç”¨æ¸¬è©¦å‘½ä»¤

### åŸºæœ¬æ¸¬è©¦åŸ·è¡Œ
```bash
# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
python run_tests.py --all

# é‹è¡Œå–®å…ƒæ¸¬è©¦
python run_tests.py --unit

# é‹è¡Œæ•´åˆæ¸¬è©¦
python run_tests.py --integration
```

### å¯Œé‚¦å¸³æˆ¶å°ˆç”¨æ¸¬è©¦
```bash
# å¯Œé‚¦å–®å…ƒæ¸¬è©¦
python run_tests.py --fubon unit

# å¯Œé‚¦æ•´åˆæ¸¬è©¦
python run_tests.py --fubon integration

# å¯Œé‚¦æ‰€æœ‰æ¸¬è©¦
python run_tests.py --fubon all
```

### ç‰¹å®šæ¸¬è©¦åŸ·è¡Œ
```bash
# é‹è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
python run_tests.py --test tests/unit/test_fubon_account_unit.py

# é‹è¡Œç‰¹å®šæ¸¬è©¦æ–¹æ³•
python run_tests.py --test tests/integration/test_fubon_account_integration.py::TestFubonAccountIntegration::test_get_cash

# ä½¿ç”¨é—œéµå­—éæ¿¾
python run_tests.py --unit --filter "parse_order"
```

### é¡¯ç¤ºè©³ç´°æ—¥èªŒ
```bash
# å–®å…ƒæ¸¬è©¦ä¸éœ€è¦æ—¥èªŒï¼Œä½†æ•´åˆæ¸¬è©¦å»ºè­°åŠ ä¸Š -s åƒæ•¸
python -m pytest tests/integration/test_fubon_account_integration.py::TestFubonAccountIntegration::test_get_cash -v -s
```

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç¯„åœ

### å¯Œé‚¦å¸³æˆ¶å–®å…ƒæ¸¬è©¦ (25 æ¸¬è©¦æ¡ˆä¾‹)
| æ¸¬è©¦é¡åˆ¥ | æ¸¬è©¦å…§å®¹ | æ¡ˆä¾‹æ•¸ |
|---------|---------|--------|
| å¸³æˆ¶åˆå§‹åŒ– | æˆåŠŸ/å¤±æ•—/æ†‘è­‰ç¼ºå¤± | 3 |
| æ•¸æ“šè§£æ | ç‹€æ…‹/æ™‚é–“/æ•¸é‡/è²·è³£åˆ¥/å§”è¨—æ¢ä»¶ | 12 |
| è‚¡ç¥¨æ•¸æ“š | åƒ¹æ ¼æå–/å§”è²·å§”è³£/Stock ç‰©ä»¶å‰µå»º | 6 |
| éŒ¯èª¤è™•ç† | ç•°å¸¸è™•ç†è£é£¾å™¨/API å¤±æ•— | 3 |
| Order å‰µå»º | finlab Order ç‰©ä»¶è½‰æ› | 1 |

### å¯Œé‚¦å¸³æˆ¶æ•´åˆæ¸¬è©¦
| æ¸¬è©¦é¡åˆ¥ | æ¸¬è©¦å…§å®¹ |
|---------|---------|
| åŸºæœ¬åŠŸèƒ½ | å¸³æˆ¶åˆå§‹åŒ–ã€é¤˜é¡æŸ¥è©¢ã€æŒå€‰æŸ¥è©¢ |
| å¸‚å ´æ•¸æ“š | è‚¡ç¥¨å ±åƒ¹ã€å§”è¨—å–®æŸ¥è©¢ |
| å§”è¨—æ“ä½œ | å»ºç«‹/å–æ¶ˆ/æ›´æ–°å§”è¨—å–®ã€é›¶è‚¡äº¤æ˜“ |
| OrderExecutor | å¤šè‚¡ç¥¨çµ„åˆã€åƒ¹æ ¼æ›´æ–°ã€ç•¶æ²–äº¤æ˜“ |
| å®‰å…¨æ¸¬è©¦ | éŒ¯èª¤æƒ…å¢ƒã€é¤˜é¡ä¸€è‡´æ€§ |

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### æ•´åˆæ¸¬è©¦å®‰å…¨æé†’
1. **æœƒä½¿ç”¨çœŸå¯¦ API**ï¼šæ•´åˆæ¸¬è©¦é€£æ¥çœŸå¯¦çš„å¯Œé‚¦è­‰åˆ¸ API
2. **å¯èƒ½å‰µå»ºå§”è¨—å–®**ï¼šæŸäº›æ¸¬è©¦æœƒå‰µå»ºçœŸå¯¦å§”è¨—å–®ï¼ˆä½†è¨­è¨ˆç‚ºä½åƒ¹é¿å…æˆäº¤ï¼‰
3. **è‡ªå‹•æ¸…ç†**ï¼šæ¸¬è©¦å®Œæˆå¾Œæœƒè‡ªå‹•å–æ¶ˆæ‰€æœ‰å§”è¨—å–®
4. **å»ºè­°ç’°å¢ƒ**ï¼šå»ºè­°åœ¨æ¸¬è©¦ç’°å¢ƒæˆ–å°é¡å¸³æˆ¶ä¸­é‹è¡Œ

### æ¸¬è©¦è¨­è¨ˆåŸå‰‡
- **å–®å…ƒæ¸¬è©¦**ï¼šå¿«é€Ÿã€éš”é›¢ã€ç„¡å‰¯ä½œç”¨
- **æ•´åˆæ¸¬è©¦**ï¼šçœŸå¯¦ã€å®Œæ•´ã€æœ‰æ¸…ç†æ©Ÿåˆ¶
- **éŒ¯èª¤è™•ç†**ï¼šæ¶µè“‹å„ç¨®ç•°å¸¸æƒ…æ³
- **æ—¥èªŒè¨˜éŒ„**ï¼šæä¾›è©³ç´°çš„åŸ·è¡Œä¿¡æ¯

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. å–®å…ƒæ¸¬è©¦å¤±æ•—
```bash
# æª¢æŸ¥ä¾è³´
pip install pytest unittest-mock

# æª¢æŸ¥è·¯å¾‘
python -c "import sys; print(sys.path)"
```

#### 2. æ•´åˆæ¸¬è©¦è·³é
```bash
# æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
python run_tests.py --env-check

# è¨­å®šæ†‘è­‰
export FUBON_NATIONAL_ID="A123456789"
# ... å…¶ä»–ç’°å¢ƒè®Šæ•¸
```

#### 3. API é€£ç·šå•é¡Œ
- æª¢æŸ¥ç¶²è·¯é€£ç·š
- ç¢ºèªæ†‘è­‰æª”æ¡ˆè·¯å¾‘æ­£ç¢º
- æª¢æŸ¥å¯Œé‚¦è­‰åˆ¸ API æœå‹™ç‹€æ…‹

#### 4. å§”è¨—å–®ç›¸é—œéŒ¯èª¤
- ç¢ºèªå¸³æˆ¶æœ‰è¶³å¤ é¤˜é¡
- æª¢æŸ¥å¸‚å ´é–‹æ”¾æ™‚é–“
- ç¢ºèªè‚¡ç¥¨ä»£ç¢¼æœ‰æ•ˆ

### æ—¥èªŒç´šåˆ¥è¨­å®š
- **INFO**: ä¸€èˆ¬æ“ä½œè³‡è¨Šï¼ˆé è¨­ï¼‰
- **DEBUG**: è©³ç´°èª¿è©¦è³‡è¨Š
- **WARNING**: è­¦å‘Šè¨Šæ¯
- **ERROR**: éŒ¯èª¤è¨Šæ¯

## ğŸš§ æœªä¾†æ“´å±•

ç›®å‰æ¸¬è©¦æ¶æ§‹ä¸»è¦é‡å°å¯Œé‚¦è­‰åˆ¸ï¼Œä½†è¨­è¨ˆç‚ºå¯æ“´å±•ï¼š

```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_fubon_account_unit.py     âœ… å·²å®Œæˆ
â”‚   â”œâ”€â”€ test_masterlink_account_unit.py  ğŸš§ è¨ˆåŠƒä¸­
â”‚   â””â”€â”€ test_fugle_account_unit.py       ğŸš§ è¨ˆåŠƒä¸­
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ fubon/                         âœ… å·²å®Œæˆ
â”‚   â”œâ”€â”€ masterlink/                    ğŸš§ è¨ˆåŠƒä¸­
â”‚   â””â”€â”€ fugle/                         ğŸš§ è¨ˆåŠƒä¸­
```

## ğŸ“ æ”¯æ´

å¦‚æœ‰æ¸¬è©¦ç›¸é—œå•é¡Œï¼Œå¯ä»¥ï¼š
1. æª¢æŸ¥æœ¬æ–‡ä»¶çš„æ•…éšœæ’é™¤ç« ç¯€
2. é‹è¡Œ `python run_tests.py --env-check` æª¢æŸ¥ç’°å¢ƒ
3. æŸ¥çœ‹æ¸¬è©¦æ—¥èªŒè¼¸å‡ºç²å–è©³ç´°éŒ¯èª¤ä¿¡æ¯

---

**ç¥æ¸¬è©¦é †åˆ©ï¼** ğŸ‰